<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
<style>
/* --- å…±é€šã‚¹ã‚¿ã‚¤ãƒ« --- */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Yu Gothic UI", sans-serif;
  background-color: #f4f4f8; margin: 0; padding: 0; color: #1C1C1E;
}
.btn {
  padding: 10px 16px; font-size: 1em; border-radius: 8px;
  border: none; cursor: pointer; text-decoration: none;
}
.btn-primary { background-color: #34C759; color: #FFFFFF; }

/* --- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ (å…±é€š) --- */
#loading-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.7); z-index: 1001;
  display: none; /* åˆæœŸã¯éè¡¨ç¤º */
  justify-content: center; align-items: center;
  color: white; font-size: 1.5em;
}

/* --- â˜…â˜…â˜… view-list (ä¸€è¦§ç”»é¢) ã®ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… --- */
#view-list {
  /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤º */
}
#view-list .header {
  background-color: #FFFFFF; padding: 16px 24px; border-bottom: 1px solid #E0E0E0;
  font-size: 1.2em; font-weight: 600;
}
#view-list .container { max-width: 1000px; margin: 24px auto; padding: 0 24px; }
#view-list .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
#view-list .search-bar { flex-grow: 1; margin-right: 16px; }
#view-list .search-bar input { width: 100%; padding: 10px 14px; font-size: 1em; border-radius: 8px; border: 1px solid #C6C6C8; }
#view-list .list-card { background-color: #FFFFFF; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); overflow: hidden; }
#view-list .list-card h2 { font-size: 1.1em; padding: 16px 20px; margin: 0; border-bottom: 1px solid #E0E0E0; }
#view-list .table-wrapper { overflow-x: auto; }
#view-list table { width: 100%; border-collapse: collapse; }
#view-list th, #view-list td { padding: 16px 20px; text-align: left; border-bottom: 1px solid #F2F2F2; }
#view-list th { font-size: 0.9em; color: #6D6D72; }
#view-list td a { color: #007AFF; text-decoration: none; margin-right: 12px; }

/* --- ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®CSS (ä¸€è¦§ç”»é¢) --- */
.modal-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: none; /* åˆæœŸã¯éè¡¨ç¤º */
  justify-content: center;
  align-items: center;
  z-index: 1000;
}
.modal-content {
  background: #FFFFFF;
  padding: 24px;
  border-radius: 12px;
  width: 500px;
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #E0E0E0;
  padding-bottom: 16px;
}
.modal-header h2 { margin: 0; }
.modal-close-btn {
  font-size: 1.5em;
  cursor: pointer;
  border: none;
  background: none;
}
.modal-body {
  padding-top: 20px;
}
.modal-body label {
  font-weight: 600;
  display: block;
  margin-bottom: 8px;
}
.modal-body input[type="file"] {
  width: 100%;
  margin-bottom: 20px;
}

/* --- â˜…â˜…â˜… view-edit (ç·¨é›†ç”»é¢) ã®ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… --- */
#view-edit {
  display: none; /* åˆæœŸã¯éè¡¨ç¤º */
  padding: 24px;
}
#view-edit .container { max-width: 1400px; margin: 0 auto; }
#view-edit .page-header { margin-bottom: 24px; }
#view-edit .page-header h2 { margin-top: 16px; }
#view-edit .back-link { color: #007AFF; text-decoration: none; }
#view-edit .btn-save { background-color: #007AFF; color: #FFFFFF; }
#view-edit .btn-export { background-color: #EFEFF4; color: #007AFF; margin-right: 8px; }

/* ç·¨é›†ç”»é¢ã®ã‚¿ãƒ– */
#view-edit .tabs { border-bottom: 2px solid #E0E0E0; margin-bottom: 0; }
#view-edit .tab-button {
  padding: 12px 18px; font-size: 1em; border: 1px solid #C6C6C8;
  border-bottom: none; background: #EFEFF4; cursor: pointer;
  margin-right: 4px; border-radius: 8px 8px 0 0;
}
#view-edit .tab-button.active {
  background: #FFFFFF; border-bottom: 2px solid #FFFFFF;
  font-weight: 600; color: #007AFF; position: relative; top: 2px;
}

/* ç·¨é›†ç”»é¢ã®Excelé¢¨ãƒ†ãƒ¼ãƒ–ãƒ« */
#view-edit .excel-sheet {
  width: 100%; border-collapse: collapse; background-color: #FFFFFF;
  border: 1px solid #C6C6C8; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
#view-edit .excel-sheet th, #view-edit .excel-sheet td {
  border: 1px solid #C6C6C8; padding: 8px; vertical-align: top; font-size: 0.9em;
}
#view-edit .header-label {
  background-color: #F4F8FA; font-weight: 600; padding: 12px 8px;
  text-align: center; width: 120px;
}
#view-edit .header-value { padding: 0; }
#view-edit .header-value input, #view-edit .header-value textarea {
  width: 100%; border: none; padding: 12px 8px; box-sizing: border-box;
  font-family: inherit; font-size: 1em;
}
#view-edit .header-value textarea { resize: vertical; min-height: 80px; }
#view-edit .agenda-header {
  background-color: #F4F8FA; font-weight: 600; padding: 12px 8px;
  text-align: center; vertical-align: middle;
}
#view-edit .main-header th {
  background-color: #F4F8FA; font-weight: 600; text-align: center;
  padding: 12px 8px;
}
#view-edit .main-content td { padding: 0; }
#view-edit .main-content input, #view-edit .main-content textarea {
  width: 100%; border: none; padding: 12px 8px; box-sizing: border-box;
  font-family: inherit; font-size: 1em; min-height: 80px;
}
#view-edit .main-content input.no-column {
  min-height: 0; text-align: center; font-weight: 600;
}
#view-edit .main-content textarea { resize: vertical; }
#view-edit .attachment-cell { text-align: center; vertical-align: middle; }
#view-edit .attachment-cell a { color: #007AFF; text-decoration: none; font-size: 1.2em; }
#view-edit .add-row-btn {
  margin-top: 12px; padding: 8px 12px; background: #EFEFF4; border: 1px solid #C6C6C8;
  cursor: pointer; border-radius: 8px;
}
</style>
</head>
<body>

<div id="loading-overlay">
  <p>AIãŒè­°äº‹éŒ²ã‚’ç”Ÿæˆä¸­ã§ã™...</p>
</div>

<div id="view-list">
  
  <div class="modal-overlay" id="new-minute-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>æ–°è¦è­°äº‹éŒ²ã‚’ä½œæˆ</h2>
        <button class="modal-close-btn" id="modal-close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <label for="transcript-upload">æ–‡å­—èµ·ã“ã—ãƒ•ã‚¡ã‚¤ãƒ«(.vtt ã¾ãŸã¯ .txt)ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:</label>
        <input type="file" id="transcript-upload" accept=".vtt,.txt">
        <button class="btn btn-primary" id="ai-generate-btn">ğŸ¤– AIã§è‡ªå‹•ç”Ÿæˆ</button>
      </div>
    </div>
  </div>
  
  <div class="header">
    è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  (æ–°ã®ã–ã‚ã“ã©ã‚‚åœ’å»ºè¨­å·¥äº‹)
  </div>

  <div class="container">
    <div class="toolbar">
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="ğŸ” &quot;ã‚¹ãƒªãƒ¼ãƒ–å›³&quot; ãªã©ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã‚’æ¤œç´¢...">
      </div>
      <button class="btn btn-primary" id="open-modal-btn">â• æ–°è¦è­°äº‹éŒ²ã‚’ä½œæˆ</button>
    </div>

    <div class="list-card">
      <h2>â–¼ è­°äº‹éŒ²ä¸€è¦§</h2>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>æ‰“åˆã›å</th>
              <th>æ‰“åˆã›æ—¥</th>
              <th>æœ€çµ‚ç·¨é›†è€…</th>
              <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
            </tr>
          </thead>
          <tbody id="minutes-list-body">
            </tbody>
        </table>
      </div>
    </div>
  </div>
</div><div id="view-edit">
  <div class="container">
    <div class="page-header">
      <a href="#" class="back-link" id="back-to-list-btn">â—€ è­°äº‹éŒ²ä¸€è¦§ã«æˆ»ã‚‹</a>
      <h2>è­°äº‹éŒ² [ç·¨é›†ãƒ¢ãƒ¼ãƒ‰]</h2>

      <br>
      <button class="btn btn-save" id="save-btn">ğŸ’¾ ä¿å­˜ (ãƒ€ãƒŸãƒ¼)</button>
      <button class="btn btn-export">â¬‡ï¸ PDF</button>
      <button class="btn btn-export">â¬‡ï¸ Excel</button>
    </div>

    <div class="tabs">
      <button class="tab-button active" data-tab="main">å®šä¾‹æ‰“åˆã›è¨˜éŒ²</button>
      <button class="tab-button" data-tab="mechanical">åˆ†ç§‘ä¼šï¼ˆæ©Ÿæ¢°è¨­å‚™ï¼‰</button>
      <button class="tab-button" data-tab="electrical">åˆ†ç§‘ä¼šï¼ˆé›»æ°—è¨­å‚™ï¼‰</button>
    </div>

    <div class="tab-content" id="tab-main">
      <table class="excel-sheet">
        <tr>
          <td class="header-label" style="width: 10%;">å·¥äº‹å</td>
          <td class="header-value" style="width: 40%;"><input type="text" id="header-kouji_mei"></td>
          <td class="agenda-header" style="width: 10%;" rowspan="4">è­°é¡Œ</td>
          <td class="header-value" colspan="3" rowspan="4" style="width: 40%;"><textarea rows="10" id="header-agenda"></textarea></td>
        </tr>
        <tr>
          <td class="header-label">æ‰“åˆã›æ—¥æ™‚</td>
          <td class="header-value"><input type="text" id="header-date_time"></td>
        </tr>
        <tr>
          <td class="header-label">æ‰“åˆã›å ´æ‰€</td>
          <td class="header-value"><input type="text" id="header-basyo"></td>
        </tr>
        <tr>
          <td class="header-label">å‡ºå¸­è€…</td>
          <td class="header-value"><input type="text" id="header-shusseki"></td>
        </tr>
        <tr class="main-header">
          <th style="width: 5%;">No.</th>
          <th style="width: 30%;">æ‰“åˆã›å†…å®¹</th>
          <th style="width: 10%;">ç™ºè¨€è€…</th>
          <th style="width: 35%;">æ¤œè¨çµæœ</th>
          <th style="width: 15%;">å›ç­”è€…</th>
          <th style="width: 5%;">æ·»ä»˜</th>
        </tr>
        <tbody id="main-table-body">
          </tbody>
      </table>
      <button class="add-row-btn" data-target="main-table-body">â• è¡Œã‚’è¿½åŠ </button>
    </div>
    
    </div>
</div><script>
document.addEventListener("DOMContentLoaded", function() {
  
  // --- ç”»é¢1 (ä¸€è¦§) ã®åˆæœŸåŒ– ---
  
  // ä¸€è¦§ã‚’ãƒ­ãƒ¼ãƒ‰
  google.script.run.withSuccessHandler(displayMinutesList)
    .loadMinutesList();

  // --- ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
  var modal = document.getElementById("new-minute-modal");
  var loadingOverlay = document.getElementById("loading-overlay");

  // ã€Œ+æ–°è¦ä½œæˆã€ãƒœã‚¿ãƒ³ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
  document.getElementById("open-modal-btn").addEventListener("click", function() {
    modal.style.display = "flex";
  });

  // ã€ŒÃ—ã€ãƒœã‚¿ãƒ³ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  document.getElementById("modal-close-btn").addEventListener("click", function() {
    modal.style.display = "none";
  });

  // ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
  modal.addEventListener("click", function(e) {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });

  // ã€ŒAIã§è‡ªå‹•ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
  document.getElementById("ai-generate-btn").addEventListener("click", handleAIGenerate);
  
  
  // --- ç”»é¢2 (ç·¨é›†) ã®åˆæœŸåŒ– ---
  
  // ã€Œä¸€è¦§ã«æˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
  document.getElementById("back-to-list-btn").addEventListener("click", function(e) {
      e.preventDefault(); // aã‚¿ã‚°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œ(ãƒªãƒ­ãƒ¼ãƒ‰)ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
      
      // ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
      document.getElementById("view-edit").style.display = "none";
      document.getElementById("view-list").style.display = "block";
  });
  
  // (ãƒ€ãƒŸãƒ¼ã®ä¿å­˜ãƒœã‚¿ãƒ³ã®å‡¦ç†)
  document.getElementById("save-btn").addEventListener("click", function() {
    alert("ä¿å­˜å‡¦ç†ã¯ç¾åœ¨ãƒ€ãƒŸãƒ¼ã§ã™ã€‚");
  });

});

// --- ç”»é¢1 (ä¸€è¦§) ã®é–¢æ•° ---

function displayMinutesList(list) {
  var tbody = document.getElementById("minutes-list-body");
  tbody.innerHTML = "";
  list.forEach(item => {
    var row = tbody.insertRow();
    row.innerHTML = '<td>' + escapeHTML(item.name) + '</td>' +
    '<td>' + escapeHTML(item.date) + '</td>' +
    '<td>' + escapeHTML(item.editor) + '</td>' +
    // TODO: ç·¨é›†ãƒœã‚¿ãƒ³ã® href ã‚‚SPAå¯¾å¿œï¼ˆDOMåˆ‡ã‚Šæ›¿ãˆï¼‰ã«ã™ã‚‹
    '<td><a href="#">ç·¨é›†</a> <a href="#">PDF</a> <a href="#">Excel</a></td>';
  });
}

function escapeHTML(str) {
  if (typeof str !== 'string') return '';
  return str.replace(/[&<>"']/g, function(match) {
    return {
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
    }[match];
  });
}

// --- AIç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ (ä¸€è¦§ãƒ»ç·¨é›†ã§å…±é€š) ---

function handleAIGenerate() {
  var fileInput = document.getElementById("transcript-upload");
  if (fileInput.files.length === 0) {
    alert("ãƒ•ã‚¡ã‚¤ãƒ«(.vtt ã¾ãŸã¯ .txt)ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  var file = fileInput.files[0];
  var fileName = file.name.toLowerCase();
  var reader = new FileReader();

  reader.onload = function(e) {
    var fileContent = e.target.result;
    var cleanTranscript = "";

    if (fileName.endsWith('.vtt')) {
      cleanTranscript = parseVTT(fileContent);
    } else if (fileName.endsWith('.txt')) {
      cleanTranscript = fileContent;
    } else {
      alert("ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚");
      return;
    }

    if (cleanTranscript.length === 0) {
      alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æœ¬æ–‡ã‚’æŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
      return;
    }

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    document.getElementById("loading-overlay").style.display = "flex";

    // ã‚µãƒ¼ãƒãƒ¼(Code.gs)ã®AIå‡¦ç†ã‚’å‘¼ã³å‡ºã™
    google.script.run.withSuccessHandler(onAIGenerationSuccess)
      .withFailureHandler(onAIGenerationFailure)
      .processTranscriptWithAI(cleanTranscript);
  };
  reader.readAsText(file);
}

function onAIGenerationSuccess(result) {
  document.getElementById("loading-overlay").style.display = "none";

  if (result.status === "success") {
    try {
      // 1. ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’æµã—è¾¼ã‚€
      populateForm(result.data);
      
      // 2. ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      document.getElementById("new-minute-modal").style.display = "none";
      
      // 3. ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ (ä¸€è¦§ã‚’éš ã—ã€ç·¨é›†ã‚’è¡¨ç¤º)
      document.getElementById("view-list").style.display = "none";
      document.getElementById("view-edit").style.display = "block";

    } catch (e) {
      alert("ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ: " + e.message);
    }
  } else {
    alert("AIã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + result.message);
  }
}

function onAIGenerationFailure(error) {
  document.getElementById("loading-overlay").style.display = "none";
  alert("ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ:\n" + error.message);
}

/**
 * VTTãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ¼ã‚µãƒ¼ (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãªã©ã‚’é™¤å»)
 */
function parseVTT(vttContent) {
  var lines = vttContent.split('\n');
  var transcript = [];
  for (var i = 0; i < lines.length; i++) {
    var line = lines[i].trim();
    // WEBVTT, ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—, NOTE, ç©ºè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
    if (line === '' || line.startsWith('WEBVTT') || line.includes('-->') || line.startsWith('NOTE')) {
      continue;
    }
    transcript.push(line);
  }
  return transcript.join('\n'); // æœ¬æ–‡ã ã‘ã‚’çµåˆã—ã¦è¿”ã™
}


// --- ç”»é¢2 (ç·¨é›†) ã®é–¢æ•° ---

/**
 * AIãŒè¿”ã—ãŸJSONãƒ‡ãƒ¼ã‚¿ã§ãƒ•ã‚©ãƒ¼ãƒ ã‚’åŸ‹ã‚ã‚‹ (rowspanãªã—ãƒ»6åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£ç‰ˆ)
 */
function populateForm(data) {
  // 1. ãƒ˜ãƒƒãƒ€ãƒ¼ã®å‡¦ç† (å¤‰æ›´ãªã—)
  document.getElementById("header-kouji_mei").value = data.header.kouji_mei || "";
  document.getElementById("header-date_time").value = data.header.date_time || "";
  document.getElementById("header-basyo").value = data.header.basyo || "";
  document.getElementById("header-shusseki").value = data.header.shusseki || "";

  var agendaText = (data.agenda || []).map(function(item) {
    return (item.no || '') + ". " + (item.title || '');
  }).join("\n");
  document.getElementById("header-agenda").value = agendaText;

  // 2. ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ« (main) ã®å‡¦ç† (rowspanãªã—ãƒ­ã‚¸ãƒƒã‚¯ã«å…¨é¢å¤‰æ›´)
  var mainBody = document.getElementById("main-table-body");
  mainBody.innerHTML = ""; // æ—¢å­˜ã®è¡Œã‚’ã‚¯ãƒªã‚¢

  if (data.agenda && data.main) {
    
    // è­°é¡Œ (agenda) ãƒªã‚¹ãƒˆã‚’ãƒ«ãƒ¼ãƒ—
    data.agenda.forEach(function(agendaItem) {
      
      // è©²å½“ã™ã‚‹è­°é¡Œã®è­°è«–ã‚’ data.main ã‹ã‚‰æŠ½å‡º
      var discussions = data.main.filter(function(mainItem) {
        return mainItem.topic_no === agendaItem.no;
      });

      // è­°è«–ãŒ1ä»¶ä»¥ä¸Šã‚ã‚‹å ´åˆ
      if (discussions.length > 0) {
        
        // è­°è«–ã®æ•°ã ã‘è¡Œã‚’ãƒ«ãƒ¼ãƒ—
        for (var i = 0; i < discussions.length; i++) {
          var discussion = discussions[i];
          var row = mainBody.insertRow();
          row.className = "main-content";
          
          var noCell = "";
          var contentCell = "";

          // â˜…ä¿®æ­£ç‚¹: 1è¡Œç›®ã‹ã©ã†ã‹ã§ã€ŒNo.ã€ã¨ã€Œæ‰“åˆã›å†…å®¹ã€ã‚’æ›¸ãåˆ†ã‘ã‚‹
          if (i === 0) {
            // --- è­°é¡Œã®1è¡Œç›® ---
            noCell = escapeHTML(agendaItem.no);
            // â˜…ä¿®æ­£ç‚¹: ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã€ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è­°é¡Œã¨å†…å®¹ã‚’çµåˆ
            contentCell = 'ã€' + escapeHTML(agendaItem.title) + 'ã€‘\n' + escapeHTML(discussion.content || '');
          } else {
            // --- è­°é¡Œã®2è¡Œç›®ä»¥é™ ---
            noCell = ""; // No. ã¯ç©ºæ¬„
            contentCell = escapeHTML(discussion.content || ''); // è­°è«–å†…å®¹ã®ã¿
          }

          // â˜…ä¿®æ­£ç‚¹: 6åˆ—ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§HTMLã‚’ç”Ÿæˆ
          row.innerHTML = 
            // Col 1: No.
            '<td><input type="text" class="no-column" value="' + noCell + '" readonly></td>' +
            
            // Col 2: æ‰“åˆã›å†…å®¹
            '<td><textarea rows="3">' + contentCell + '</textarea></td>' + 
            
            // Col 3: ç™ºè¨€è€…
            '<td><input type="text" value="' + escapeHTML(discussion.speaker || '') + '"></td>' +
            
            // Col 4: æ¤œè¨çµæœ
            '<td><textarea rows="3">' + escapeHTML(discussion.result || '') + '</textarea></td>' +
            
            // Col 5: å›ç­”è€…
            '<td><input type="text" value="' + escapeHTML(discussion.responder || '') + '"></td>' +
            
            // Col 6: æ·»ä»˜
            '<td class="attachment-cell"><a href="#">â•</a></td>';
        }
        
      } else {
        // --- è©²å½“ã™ã‚‹è­°è«–ãŒ0ä»¶ã®å ´åˆ (è­°é¡Œã®ã¿è¡¨ç¤º) ---
        var row = mainBody.insertRow();
        row.className = "main-content";
        row.innerHTML = 
          '<td><input type="text" class="no-column" value="' + escapeHTML(agendaItem.no) + '" readonly></td>' +
          '<td><textarea rows="3">ã€' + escapeHTML(agendaItem.title) + 'ã€‘\nï¼ˆè©²å½“ã®è­°è«–ãªã—ï¼‰</textarea></td>' +
          '<td><input type="text"></td>' +
          '<td><textarea rows="3"></textarea></td>' +
          '<td><input type="text"></td>' +
          '<td class="attachment-cell"><a href="#">â•</a></td>';
      }
    });
  }
}

</script>
</body>
</html>
